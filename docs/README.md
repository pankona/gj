# 設計のメモなどを書くところ

## スプライトをクリックしたらコールバックする

### 概要

「if クリックを検知したら～」という処理をメインループに書き下していくと、クリック判定の分岐があちこちに散らばってしまう。
もうちょっと見通しを良くするために、各オブジェクトには「onClick」みたいなメソッドを持たせておき、クリックされたらその関数をコールバックするような仕組みにしておきたい。

### 設計

あらゆるものがクリック対象になるわけではないので、クリック対象はつけ外しができる必要がある。AddEventListener/RemoveEventListener のノリで実装すればよさそう。

スプライトが重なっているとき、一番手前のスプライトだけクリックを受けて後ろのスプライトには効果が及ばないようにするのが良いような気がする。JavaScript でいうところの event.preventDefault がデフォルトの振る舞いであるようなイメージ。
これをやるためには、複数のスプライトが AddEventListener されていたとして、誰が一番手前にいるのかというのを処理する必要がある。z-index のようなものをスプライトには持たせておき、これで AddEventListener されたものをあらかじめソートしておく (新規に AddEventListener されたときにソートする) のが良いような気がしている。

クリックイベントが発生したとき、AddEventListener されたオブジェクト全てに対して以下の処理を行う。

- クリック位置が、自身に重なっているか？
  - YES ならば当該オブジェクトの onClick を呼び出し、ループを終了する
  - No ならば、次のオブジェクトに対する評価に移る

### 懸念など

オブジェクトの数が多くなってくるとループが長くなるので、パフォーマンスに影響するかもしれない？

- 100も200もクリック対象がある、という状況は考えにくいというか、そういう UI にしちゃいけないような気はする

## 音を出す仕組み

### 概要

何かが起きたら音を出したいことがある。効果音も BGM もある。
これも if 文で分岐しだすと見通しが悪くなるような気がしている。そもそも音とゲームロジックはなるべく分離しておきたい。

### 設計

「何かが起きる」はイベントとして表現する。pubsub じみた仕組みを導入し、イベントをサブスクライブする誰かがいるような構成にする。
「音を鳴らすやつ」はイベントを購読している。イベントを見て、対応する音を鳴らす仕組みにする。

### 懸念など

イベントは channel を用いた queue 構造で表せばいいかな？と思っているが、一時にあまりにもたくさんのイベントがつまれてしまうと、同フレームで処理しきれなくなってしまうようなことも起こるかもしれない？
